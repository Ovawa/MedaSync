{% extends "base.html" %}

{% block page_title %}Schedule Appointment{% endblock %}

{% block content %}
<div class="form-container">
    <h2>Schedule New Appointment</h2>

    <form method="POST" action="{{ url_for('add_appointment') }}" onsubmit="return validateAppointmentForm()">
        <div id="availability_status" class="availability-status"></div>
        <div class="form-row">
            <div class="form-group">
                <label for="patient_id">Patient *</label>
                <select id="patient_id" name="patient_id" required>
                    <option value="">Select Patient</option>
                    {% for patient in patients %}
                    <option value="{{ patient.id }}">{{ patient.id }} - {{ patient.name }} {{ patient.surname }}</option>
                    {% endfor %}
                </select>
                <div style="margin-top: 10px;">
                    <a href="{{ url_for('add_patient') }}" class="btn btn-sm" 
                       style="background: var(--light-purple); color: white;">
                        <i class="fas fa-plus"></i> New Patient
                    </a>
                </div>
                {% if not patients %}
                <small class="form-help text-warning">No patients available. <a href="{{ url_for('add_patient') }}">Add a patient first</a>.</small>
                {% endif %}
            </div>

            <div class="form-group">
                <label for="doctor_id">Doctor *</label>
                <select id="doctor_id" name="doctor_id" required>
                    <option value="">Select Doctor</option>
                    {% for doctor in doctors %}
                    <option value="{{ doctor.id }}">{{ doctor.id }} - Dr. {{ doctor.name }} {{ doctor.surname }} ({{ doctor.specialization }})</option>
                    {% endfor %}
                </select>
                {% if not doctors %}
                <small class="form-help text-warning">No doctors available. <a href="{{ url_for('add_doctor') }}">Add a doctor first</a>.</small>
                {% endif %}
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="date">Date *</label>
                <input type="date" id="date" name="date" required>
            </div>

            <div class="form-group">
                <label for="time">Time *</label>
                <div class="time-input-container">
                    <input type="text" id="time" name="time" 
                           placeholder="HH:MM" 
                           pattern="[0-9]{2}:[0-9]{2}"
                           title="Enter time in HH:MM format (24-hour)">
                    <small class="form-help">Or select from dropdown</small>
                    <select id="time_dropdown" onchange="document.getElementById('time').value = this.value">
                        <option value="">Select Time</option>
                        {% for time_slot in time_slots %}
                        <option value="{{ time_slot }}">{{ time_slot }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="duration">Duration (minutes) *</label>
                <input type="number" id="duration" name="duration" min="1" max="240" value="30" required>
                <small class="form-help">Enter duration in minutes (1-240)</small>
            </div>
            
            <div class="form-group">
                <label for="end_time">End Time</label>
                <input type="text" id="end_time" readonly class="readonly-field">
                <small class="form-help">Calculated automatically</small>
            </div>
        </div>

        <div class="form-group">
            <label for="diagnosis">Diagnosis Notes</label>
            <textarea id="diagnosis" name="diagnosis" rows="4"></textarea>
        </div>

        <button type="submit" id="submit_btn" class="btn btn-primary">Schedule Appointment</button>
        <a href="{{ url_for('appointments') }}" class="btn btn-secondary">Cancel</a>
    </form>
    <div id="availability_status" style="margin-top:10px"></div>
</div>
{% endblock %}