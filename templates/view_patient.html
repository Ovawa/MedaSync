{% extends "base.html" %}

{% block page_title %}Patient Details - {{ patient.name }} {{ patient.surname }}{% endblock %}

{% block content %}
<div class="page-header">
    <h2>Patient Details: {{ patient.id }} - {{ patient.name }} {{ patient.surname }}</h2>
    <div>
        <a href="{{ url_for('edit_patient', patient_id=patient.id) }}" class="btn btn-primary">
            <i class="fas fa-edit"></i> Edit Patient
        </a>
        {% if is_admin %}
        <a href="{{ url_for('delete_patient', patient_id=patient.id) }}" class="btn btn-danger" 
           onclick="return confirm('Are you sure you want to delete this patient?');">
            <i class="fas fa-trash"></i> Delete Patient
        </a>
        {% endif %}
        <a href="{{ url_for('patients') }}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Back to Patients
        </a>
    </div>
</div>

<div class="form-container">
    <div class="patient-details">
        <div class="detail-row">
            <div class="detail-item">
                <strong>Name:</strong> {{ patient.name }} {{ patient.surname }}
            </div>
            <div class="detail-item">
                <strong>Date of Birth:</strong> {{ patient.date_of_birth }}
            </div>
        </div>
        <div class="detail-row">
            <div class="detail-item">
                <strong>Gender:</strong> {{ patient.gender }}
            </div>
            <div class="detail-item">
                <strong>Contact:</strong> {{ patient.country_code }}{{ patient.contact_number }}
            </div>
        </div>
        <div class="detail-row">
            <div class="detail-item">
                <strong>Email:</strong> {{ patient.email or 'Not provided' }}
            </div>
        </div>
    </div>
</div>

<div class="dashboard-section">
    <h2>Appointments (All)</h2>
    {% if appointments %}
    <table>
        <thead>
            <tr>
                <th>Date</th>
                <th>Time</th>
                <th>Doctor</th>
                <th>Specialization</th>
                <th>Diagnosis</th>
            </tr>
        </thead>
        <tbody>
            {% for appt in appointments %}
            <tr>
                <td>{{ appt.date }}</td>
                <td>{{ appt.time }}</td>
                <td>Dr. {{ appt.doctor.name }} {{ appt.doctor.surname }}</td>
                <td>{{ appt.doctor.specialization }}</td>
                <td>{{ appt.diagnosis[:50] }}{% if appt.diagnosis|length > 50 %}...{% endif %}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="no-data">No appointments found for this patient.</p>
    {% endif %}
</div>

<div class="dashboard-section">
    <h2>Upcoming Appointments</h2>
    {% if upcoming_appointments %}
    <table>
        <thead>
            <tr>
                <th>Date</th>
                <th>Time</th>
                <th>Doctor</th>
                <th>Specialization</th>
                <th>Diagnosis</th>
            </tr>
        </thead>
        <tbody>
            {% for appt in upcoming_appointments %}
            <tr>
                <td>{{ appt.date }}</td>
                <td>{{ appt.time }}</td>
                <td>Dr. {{ appt.doctor.name }} {{ appt.doctor.surname }}</td>
                <td>{{ appt.doctor.specialization }}</td>
                <td>{{ appt.diagnosis[:50] }}{% if appt.diagnosis|length > 50 %}...{% endif %}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="no-data">No upcoming appointments for this patient.</p>
    {% endif %}
</div>

<div class="dashboard-section">
    <h2>Past Appointments</h2>
    {% if past_appointments %}
    <table>
        <thead>
            <tr>
                <th>Date</th>
                <th>Time</th>
                <th>Doctor</th>
                <th>Specialization</th>
                <th>Diagnosis</th>
            </tr>
        </thead>
        <tbody>
            {% for appt in past_appointments %}
            <tr>
                <td>{{ appt.date }}</td>
                <td>{{ appt.time }}</td>
                <td>Dr. {{ appt.doctor.name }} {{ appt.doctor.surname }}</td>
                <td>{{ appt.doctor.specialization }}</td>
                <td>{{ appt.diagnosis[:50] }}{% if appt.diagnosis|length > 50 %}...{% endif %}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="no-data">No past appointments found for this patient.</p>
    {% endif %}
</div>
{% endblock %}